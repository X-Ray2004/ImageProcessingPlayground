import numpy as np
import matplotlib.pyplot as plt
from scipy import signal
from PIL import Image
import cv2
def read_and_convert_to_gray(image_path):
    """Read image and convert to grayscale"""
    # Read image
    img = cv2.imread(image_path)
    # Convert BGR to RGB
    img_rgb = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)
    # Convert to grayscale
    img_gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
    return img_rgb, img_gray
def add_gaussian_noise(image, mean=0, std=25):
    """Add Gaussian noise to image"""
    noise = np.random.normal(mean, std, image.shape)
    noisy_image = image + noise
    # Clip values to valid range [0, 255]
    noisy_image = np.clip(noisy_image, 0, 255).astype(np.uint8)
    return noisy_image
def wiener_filter(image, kernel_size, noise_var=100):
    """Apply Wiener filter to image"""
    # Convert to float
    img_float = image.astype(np.float64)
   
    # Create mean filter kernel
    kernel = np.ones((kernel_size, kernel_size)) / (kernel_size ** 2)
   
    # Estimate local mean
    local_mean = signal.convolve2d(img_float, kernel, mode='same', boundary='symm')
   
    # Estimate local variance
    local_sq_mean = signal.convolve2d(img_float**2, kernel, mode='same', boundary='symm')
    local_var = local_sq_mean - local_mean**2
    local_var = np.maximum(local_var, 0) # Ensure non-negative
   
    # Wiener filter formula
    wiener_gain = local_var / (local_var + noise_var)
    filtered = local_mean + wiener_gain * (img_float - local_mean)
   
    # Clip and convert back to uint8
    filtered = np.clip(filtered, 0, 255).astype(np.uint8)
    return filtered
def harmonic_mean_filter(image, kernel_size):
    """Apply Harmonic Mean filter to image"""
    # Pad image
    pad = kernel_size // 2
    padded = np.pad(image.astype(np.float64), pad, mode='reflect')
   
    # Initialize output
    output = np.zeros_like(image, dtype=np.float64)
   
    # Apply harmonic mean filter
    for i in range(image.shape[0]):
        for j in range(image.shape[1]):
            # Extract neighborhood
            neighborhood = padded[i:i+kernel_size, j:j+kernel_size]
            # Avoid division by zero
            neighborhood = np.maximum(neighborhood, 1e-6)
            # Harmonic mean: n / sum(1/x)
            harmonic_mean = kernel_size**2 / np.sum(1.0 / neighborhood)
            output[i, j] = harmonic_mean
   
    # Clip and convert back to uint8
    output = np.clip(output, 0, 255).astype(np.uint8)
    return output
def main():
    # Image path - change this to your image file
    image_path = r"C:\Users\zamzam\Downloads\Jellyfish.jpg"
   
    print("Step 1: Reading image and converting to grayscale...")
    img_rgb, img_gray = read_and_convert_to_gray(image_path)
   
    # Display original and grayscale
    plt.figure(figsize=(12, 5))
    plt.subplot(1, 2, 1)
    plt.imshow(img_rgb)
    plt.title('Original Image')
    plt.axis('off')
   
    plt.subplot(1, 2, 2)
    plt.imshow(img_gray, cmap='gray')
    plt.title('Grayscale Image')
    plt.axis('off')
    plt.tight_layout()
    plt.savefig('1_grayscale.png', dpi=150, bbox_inches='tight')
    plt.show()
   
    print("\nStep 2: Adding Gaussian noise...")
    img_noisy = add_gaussian_noise(img_gray, mean=0, std=25)
   
    # Display noisy image
    plt.figure(figsize=(6, 5))
    plt.imshow(img_noisy, cmap='gray')
    plt.title('Image with Gaussian Noise')
    plt.axis('off')
    plt.tight_layout()
    plt.savefig('2_noisy_image.png', dpi=150, bbox_inches='tight')
    plt.show()
   
    print("\nStep 3: Applying Wiener filters (5x5 and 3x3)...")
    img_wiener_5 = wiener_filter(img_noisy, kernel_size=5, noise_var=100)
    img_wiener_3 = wiener_filter(img_noisy, kernel_size=3, noise_var=100)
   
    # Display comparison of Wiener filters
    plt.figure(figsize=(15, 5))
   
    plt.subplot(1, 3, 1)
    plt.imshow(img_noisy, cmap='gray')
    plt.title('Noisy Image')
    plt.axis('off')
   
    plt.subplot(1, 3, 2)
    plt.imshow(img_wiener_5, cmap='gray')
    plt.title('Wiener Filter (5×5)')
    plt.axis('off')
   
    plt.subplot(1, 3, 3)
    plt.imshow(img_wiener_3, cmap='gray')
    plt.title('Wiener Filter (3×3)')
    plt.axis('off')
   
    plt.tight_layout()
    plt.savefig('3_wiener_comparison.png', dpi=150, bbox_inches='tight')
    plt.show()
   
    print("\nStep 4: Applying Harmonic Mean filter (3x3)...")
    img_harmonic = harmonic_mean_filter(img_noisy, kernel_size=3)
   
    # Display harmonic filter result
    plt.figure(figsize=(6, 5))
    plt.imshow(img_harmonic, cmap='gray')
    plt.title('Harmonic Mean Filter (3×3)')
    plt.axis('off')
    plt.tight_layout()
    plt.savefig('4_harmonic_filter.png', dpi=150, bbox_inches='tight')
    plt.show()
   
if *name* == "*main*":
    main()
